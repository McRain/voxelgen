(()=>{"use strict";var e,n={247:(e,n,t)=>{var o={};t.r(o),t.d(o,{user:()=>i});var r=t(751),a=t(302),l=t(953);a.A.default||a.A;const i=(0,l.Kh)({id:"mee"});var s=t(641);const d={class:"app-container"},c={id:"canvas",ref:"canvas"};var u=t(33);const p={class:"app-container"},h={key:0,class:"file-upload-panel"},f={class:"file-input-container"},m={key:0,class:"file-name"},w={key:0,class:"upload-status"},b={key:1,class:"uploaded-files"},v=["onClick"],y={class:"control-panel"},g={class:"buttons-group"},k={class:"switches-group"},x={class:"switch-container"},B={class:"sliders-group"},L={class:"slider-container"},S={class:"slider-container"},M={class:"slider-container"},V={class:"slider-container"};var C=t(888),F=t(51),P=t(922),E=t(437),O=t(409),j=t(24),W=t(554),A=t(566);function z(e){const{geometry:n,count:t}=e,o=[],r=new P.kn4;for(let a=0;a<t;a++){e.getMatrixAt(a,r);const t=n.clone();t.applyMatrix4(r),o.push(t)}return A.pP(o)}let I,R,U,T,Q,_,H;P.eaF.prototype.raycast=O.zQ,P.LoY.prototype.computeBoundsTree=O.LO,P.LoY.prototype.disposeBoundsTree=O.je,P.$Ed.prototype.computeBoundsTree=O.K5,P.$Ed.prototype.disposeBoundsTree=O.Of,P.$Ed.prototype.raycast=O.zQ;let $,G,X,N=!1,J=null;const D=new P.mrM({color:0,linewidth:.5}),K=[];let Z={model:"Torus Knot",scale:1.5,resolution:40,solid:!1,displayMesh:!0,displayBounds:!1,insideOnly:!1,randomcolor:!1,rebuild:()=>N=!0};const q={},Y=new P._4j({transparent:!0,opacity:1});function ee(){if(requestAnimationFrame(ee),U.updateMatrixWorld(!0),N&&(J=function*(){if(!$)return;const e=Z.resolution;X=e**3;const n=Z.scale,t=n/e,o=new P.Q1f(16777215),r=new P.Q1f(16761095).convertSRGBToLinear();Q&&Q.instanceMatrix.count!==X&&(Q.material.dispose(),Q.dispose(),Q.parent.remove(Q),Q=null);const{model:a,bvh:l}=$;if(!a)return;Q||(Q=new P.ZLX(new P.iNn(1,1,1),Y,X),Q.frustumCulled=!1,Q.setColorAt(0,o),U.add(Q)),K.length=0;const i=-n/2+.5*t,s=new P.Pq0,d=new P.PTz,c=(new P.Pq0).setScalar(t),u=new P.kn4,p=new P.NRn,h=(new P.kn4).copy(a.matrixWorld).invert(),f=new P.RlV;f.direction.set(0,0,1);let m=0;console.log("for");for(let n=0;n<e;n++)for(let a=0;a<e;a++)for(let w=0;w<e;w++){if(s.set(i+a*t,i+n*t,i+w*t),p.min.setScalar(-.5*t).add(s),p.max.setScalar(.5*t).add(s),l.intersectsBox(p,h))K.push(s.clone()),u.compose(s,d,c),Q.setMatrixAt(m,u),Q.setColorAt(m,o),Q.instanceMatrix.needsUpdate=!0,Q.instanceColor.needsUpdate=!0,m++;else if(Z.solid){f.origin.copy(s).applyMatrix4(h);const e=l.raycastFirst(f,2);e&&e.face.normal.dot(f.direction)>0&&(K.push(s.clone()),u.compose(s,d,c),Q.setMatrixAt(m,u),Q.setColorAt(m,r),Q.instanceMatrix.needsUpdate=!0,Q.instanceColor.needsUpdate=!0,m++)}Q.count=m,yield}Q.count=m}(),N=!1),J){let e=window.performance.now();for(;window.performance.now()-e<16;)if(J.next().done){if(J=null,!Q)return;if(Z.randomcolor){const e=new P.Q1f;for(let n=0;n<X;n++)e.setRGB(Math.random(),Math.random(),Math.random()),Q.setColorAt(n,e);Q.instanceColor.needsUpdate=!0}if(0===Q.count)return;const e=z(Q);G&&U.remove(G),G=new P.DXC(new P.TDQ(e),D),U.add(G),G.renderOrder=0;break}}H&&(H.object.scale.setScalar(Z.scale),H.object.updateMatrixWorld(!0),H.update());for(const e in q){const n=q[e];n.model&&(n.model.visible=!1)}I.render(U,R)}function ne(e){U.add(e.model),$=e,N=!0}function te(e){Z={...Z,...e},N=!0}var oe=t(747);class re{constructor(e){this.name="WorkerBase",this.running=!1,this.worker=e,this.worker.onerror=e=>{throw e.message?new Error(`${this.name}: Could not create Web Worker with error "${e.message}"`):new Error(`${this.name}: Could not create Web Worker.`)}}runTask(){}generate(...e){if(this.running)throw new Error("GenerateMeshBVHWorker: Already running job.");if(null===this.worker)throw new Error("GenerateMeshBVHWorker: Worker has been disposed.");this.running=!0;const n=this.runTask(this.worker,...e);return n.finally(()=>{this.running=!1}),n}dispose(){this.worker.terminate(),this.worker=null}}class ae extends re{constructor(){super(new Worker(new URL(t.p+t.u(231),t.b),{type:void 0})),this.name="GenerateMeshBVHWorker"}runTask(e,n,t={}){return new Promise((o,r)=>{if(n.getAttribute("position").isInterleavedBufferAttribute||n.index&&n.index.isInterleavedBufferAttribute)throw new Error("GenerateMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.");e.onerror=e=>{r(new Error(`GenerateMeshBVHWorker: ${e.message}`))},e.onmessage=a=>{const{data:l}=a;if(l.error)r(new Error(l.error)),e.onmessage=null;else if(l.serialized){const{serialized:r,position:a}=l,i=oe.G.deserialize(r,n,{setIndex:!1}),s=Object.assign({setBoundingBox:!0},t);if(n.attributes.position.array=a,r.index)if(n.index)n.index.array=r.index;else{const e=new P.THS(r.index,1,!1);n.setIndex(e)}s.setBoundingBox&&(n.boundingBox=i.getBoundingBox(new P.NRn)),t.onProgress&&t.onProgress(l.progress),o(i),e.onmessage=null}else t.onProgress&&t.onProgress(l.progress)};const a=n.index?n.index.array:null,l=n.attributes.position.array,i=[l];a&&i.push(a),e.postMessage({index:a,position:l,options:{...t,onProgress:null,includedProgressCallback:Boolean(t.onProgress),groups:[...n.groups]}},i.map(e=>e.buffer).filter(e=>"undefined"==typeof SharedArrayBuffer||!(e instanceof SharedArrayBuffer)))})}}const le=new P.V9B({transparent:!0,wireframe:!0,depthWrite:!1,opacity:.02});let ie,se;const de={name:"FileManagerApp",data:()=>({selectedFile:null,uploadStatus:"",uploadedFiles:[],randomColor:!1,switch2:!1,scaleValue:1.5,resolutionValue:40,opacityValue:1,filePanel:!1,sizeValue:1,insideValue:!1}),methods:{handleFileSelect(e){const n=e.target.files;n.length>0&&(this.selectedFile=n[0],this.uploadFile())},async uploadFile(){if(!this.selectedFile)return;ie&&(U.remove(ie),ie=null),this.uploadStatus="Загрузка...";const e=await this.selectedFile.arrayBuffer();(new C.B).setMeshoptDecoder(F.f).parse(e,"",e=>{const n=[];e.scene.updateMatrixWorld(!0),e.scene.traverse(e=>{if(e.isMesh&&e.geometry){const t=e.geometry.clone();t.applyMatrix4(e.matrixWorld),n.push(t)}}),console.log(n);const t=A.pP(n);console.log(t),ie=new P.eaF(t,le),ie.geometry.center(),ie.scale.setScalar(this.scaleValue),(new ae).generate(ie.geometry).then(e=>{se=e,ne({model:ie,bvh:e}),this.filePanel=!1})})},removeFile(e){this.uploadedFiles.splice(e,1)},formatFileSize(e){if(0===e)return"0 Bytes";const n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,n)).toFixed(2))+" "+["Bytes","KB","MB","GB"][n]},handleButton1(){this.filePanel=!0},handleButton2(){},handleButton3(){!function(e,n="model.obj"){try{const t=z(e),o=new P.eaF(t,Array.isArray(e.material)?e.material[0]:e.material),r=(new W.j).parse(o),a=new Blob([r],{type:"text/plain"}),l=document.createElement("a");l.href=URL.createObjectURL(a),l.download=n,l.click(),URL.revokeObjectURL(l.href)}catch(e){console.error("Export error:",e)}}(Q)},handleButton4(){!function(e,n="model.vox"){try{const t=new Blob([JSON.stringify(e)],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(t),o.download=n,o.click(),URL.revokeObjectURL(o.href)}catch(e){console.error("Export error:",e)}}(K)},handleSwitch1(){te({randomcolor:this.randomColor})},handleInside(){te({insideOnly:this.insideValue})},handleSwitch2(){},handleSlider1(){te({scale:this.scaleValue})},handleSlider2(){te({resolution:this.resolutionValue})},handleOpacity(){var e;e={opacity:this.opacityValue},Object.keys(e).forEach(n=>{Y[n]=e[n]})},handleSize(){ie&&(ie.scale.setScalar(this.sizeValue),ne({model:ie,bvh:se}))}}};var ce=t(262);const ue=(0,ce.A)(de,[["render",function(e,n,t,o,a,l){return(0,s.uX)(),(0,s.CE)("div",p,[a.filePanel?((0,s.uX)(),(0,s.CE)("div",h,[n[16]||(n[16]=(0,s.Lk)("h2",null,"Загрузка файла",-1)),(0,s.Lk)("div",f,[(0,s.Lk)("input",{type:"file",id:"fileInput",ref:"fileInput",onChange:n[0]||(n[0]=(...e)=>l.handleFileSelect&&l.handleFileSelect(...e)),class:"file-input"},null,544),n[14]||(n[14]=(0,s.Lk)("label",{for:"fileInput",class:"file-input-label"}," Выберите файл ",-1)),a.selectedFile?((0,s.uX)(),(0,s.CE)("span",m,(0,u.v_)(a.selectedFile.name),1)):(0,s.Q3)("v-if",!0)]),(0,s.Q3)(' <button @click="uploadFile" :disabled="!selectedFile" class="upload-button">\r\n                Загрузить\r\n            </button> '),a.uploadStatus?((0,s.uX)(),(0,s.CE)("div",w,(0,u.v_)(a.uploadStatus),1)):(0,s.Q3)("v-if",!0),a.uploadedFiles.length>0?((0,s.uX)(),(0,s.CE)("div",b,[n[15]||(n[15]=(0,s.Lk)("h3",null,"Загруженные файлы:",-1)),(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a.uploadedFiles,(e,n)=>((0,s.uX)(),(0,s.CE)("li",{key:n},[(0,s.eW)((0,u.v_)(e.name)+" ("+(0,u.v_)(l.formatFileSize(e.size))+") ",1),(0,s.Lk)("button",{onClick:e=>l.removeFile(n),class:"remove-button"}," Удалить ",8,v)]))),128))])])):(0,s.Q3)("v-if",!0)])):(0,s.Q3)("v-if",!0),(0,s.Q3)(" Панель управления "),(0,s.Lk)("div",y,[(0,s.Lk)("div",g,[(0,s.Lk)("button",{onClick:n[1]||(n[1]=(...e)=>l.handleButton1&&l.handleButton1(...e)),class:"control-button"},"Load model"),(0,s.Q3)(' <button @click="handleButton2" class="control-button">Build</button> '),(0,s.Lk)("button",{onClick:n[2]||(n[2]=(...e)=>l.handleButton3&&l.handleButton3(...e)),class:"control-button"},"Download Model"),(0,s.Lk)("button",{onClick:n[3]||(n[3]=(...e)=>l.handleButton4&&l.handleButton4(...e)),class:"control-button"},"Download Voxels")]),(0,s.Lk)("div",k,[(0,s.Lk)("div",x,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[4]||(n[4]=e=>a.randomColor=e),onChange:n[5]||(n[5]=(...e)=>l.handleSwitch1&&l.handleSwitch1(...e))},null,544),[[r.lH,a.randomColor]]),n[17]||(n[17]=(0,s.eW)(" Random colors "))])]),(0,s.Q3)(' <div class="switch-container">\r\n                    <label>\r\n                        <input type="checkbox" v-model="insideValue" @change="handleInside">\r\n                        Inside\r\n                    </label>\r\n                </div> '),(0,s.Q3)(' <div class="switch-container">\r\n                    <label>\r\n                        <input type="checkbox" v-model="switch2" @change="handleSwitch2">\r\n                        Переключатель 2\r\n                    </label>\r\n                </div> ')]),(0,s.Lk)("div",B,[(0,s.Lk)("div",L,[(0,s.Lk)("label",null,"Scale: "+(0,u.v_)(a.scaleValue),1),(0,s.bo)((0,s.Lk)("input",{type:"range",min:"0.1",max:"10",step:"0.1","onUpdate:modelValue":n[6]||(n[6]=e=>a.scaleValue=e),onInput:n[7]||(n[7]=(...e)=>l.handleSlider1&&l.handleSlider1(...e)),class:"slider"},null,544),[[r.Jo,a.scaleValue]])]),(0,s.Lk)("div",S,[(0,s.Lk)("label",null,"Resolution: "+(0,u.v_)(a.resolutionValue),1),(0,s.bo)((0,s.Lk)("input",{type:"range",min:"5",max:"75",step:"5","onUpdate:modelValue":n[8]||(n[8]=e=>a.resolutionValue=e),onInput:n[9]||(n[9]=(...e)=>l.handleSlider2&&l.handleSlider2(...e)),class:"slider"},null,544),[[r.Jo,a.resolutionValue]])]),(0,s.Lk)("div",M,[(0,s.Lk)("label",null,"Opacity: "+(0,u.v_)(a.opacityValue),1),(0,s.bo)((0,s.Lk)("input",{type:"range",min:"0",max:"1",step:"0.1","onUpdate:modelValue":n[10]||(n[10]=e=>a.opacityValue=e),onInput:n[11]||(n[11]=(...e)=>l.handleOpacity&&l.handleOpacity(...e)),class:"slider"},null,544),[[r.Jo,a.opacityValue]])]),(0,s.Lk)("div",V,[(0,s.Lk)("label",null,"Model size: "+(0,u.v_)(a.sizeValue),1),(0,s.bo)((0,s.Lk)("input",{type:"number",min:"0",step:"0.05","onUpdate:modelValue":n[12]||(n[12]=e=>a.sizeValue=e),onInput:n[13]||(n[13]=(...e)=>l.handleSize&&l.handleSize(...e)),class:"slider"},null,544),[[r.Jo,a.sizeValue]])])])])])}],["__scopeId","data-v-6c7c794e"]]),pe={data:()=>({inGame:!1}),async mounted(){document.documentElement.setAttribute("data-theme","dark");const e=this.$refs.canvas;!function(e){const n=window.devicePixelRatio||1;e.forEach(e=>{e.width=e.clientWidth*n,e.height=e.clientHeight*n})}([e]),function(e){T=document.getElementById("output"),I=new E.JeP({antialias:!0,canvas:e}),I.setPixelRatio(window.devicePixelRatio),I.setSize(window.innerWidth,window.innerHeight),I.setClearColor(1449501,1),U=new P.Z58;const n=new P.ZyN(16777215,2);n.position.set(3,6,9),U.add(n);const t=new P.ZyN(16777215,.5);t.position.set(-3,-6,-9),U.add(t);const o=new P.$p8(16777215,.75);U.add(o),R=new P.ubm(75,window.innerWidth/window.innerHeight,.01,100),R.position.set(1,2,3),R.updateProjectionMatrix(),_=new j.N(R,I.domElement);const r=new P.eaF(new P.iNn);H=new P.IWo(r,16777215),H.material.opacity=.35,H.material.transparent=!0,U.add(H),window.addEventListener("resize",function(){R.aspect=window.innerWidth/window.innerHeight,R.updateProjectionMatrix(),I.setSize(window.innerWidth,window.innerHeight)},!1),ee()}(e)},components:{Project:ue}},he=(0,ce.A)(pe,[["render",function(e,n,t,o,r,a){const l=(0,s.g2)("Project");return(0,s.uX)(),(0,s.CE)("div",d,[(0,s.Lk)("canvas",c,null,512),(0,s.bF)(l)])}]]),fe=a.A.default||a.A,me=window.vue=(0,r.Ef)(he);me.use(e=>{e.config.globalProperties.$app=fe.Init(o),me.provide("app",e.config.globalProperties.$app)}),me.mount("#app")}},t={};function o(e){var r=t[e];if(void 0!==r)return r.exports;var a=t[e]={exports:{}};return n[e](a,a.exports,o),a.exports}o.m=n,e=[],o.O=(n,t,r,a)=>{if(!t){var l=1/0;for(c=0;c<e.length;c++){for(var[t,r,a]=e[c],i=!0,s=0;s<t.length;s++)(!1&a||l>=a)&&Object.keys(o.O).every(e=>o.O[e](t[s]))?t.splice(s--,1):(i=!1,a<l&&(l=a));if(i){e.splice(c--,1);var d=r();void 0!==d&&(n=d)}}return n}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[t,r,a]},o.d=(e,n)=>{for(var t in n)o.o(n,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},o.u=e=>e+".4a724805.chunk.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.j=792,o.p="/",(()=>{o.b=document.baseURI||self.location.href;var e={792:0};o.O.j=n=>0===e[n];var n=(n,t)=>{var r,a,[l,i,s]=t,d=0;if(l.some(n=>0!==e[n])){for(r in i)o.o(i,r)&&(o.m[r]=i[r]);if(s)var c=s(o)}for(n&&n(t);d<l.length;d++)a=l[d],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(c)},t=self.webpackChunkvoxel_creator=self.webpackChunkvoxel_creator||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})();var r=o.O(void 0,[489,810,642,753,776,466],()=>o(247));r=o.O(r)})();